<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Clean Bubble Shooter</title>
    <style>
        body {
            background: #0d1117;
            color: #c9d1d9;
            font-family: sans-serif;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            margin: 0;
            overflow: hidden;
        }
        #score { font-size: 24px; margin-bottom: 10px; color: #58a6ff; font-weight: bold; }
        #game-container {
            position: relative;
            border: 4px solid #30363d;
            border-radius: 12px;
            background: #161b22;
            box-shadow: 0 10px 30px rgba(0,0,0,0.5);
        }
        canvas { display: block; cursor: crosshair; }
        .controls { margin-top: 15px; color: #8b949e; font-size: 14px; }
    </style>
</head>
<body>

    <div id="score">SCORE: 0</div>
    <div id="game-container">
        <canvas id="gameCanvas" width="400" height="600"></canvas>
    </div>
    <div class="controls">마우스를 움직여 조준하고 클릭해서 발사하세요!</div>

<script>
const canvas = document.getElementById('gameCanvas');
const ctx = canvas.getContext('2d');
const scoreDelta = document.getElementById('score');

const ROWS = 10;
const COLS = 10;
const RADIUS = 20;
const COLORS = ['#ff5f56', '#58a6ff', '#3fb950', '#d299ff', '#f8e3a1'];

let arena = [];
let playerBall = null;
let score = 0;
let mousePos = { x: 200, y: 0 };

// 초기화
function init() {
    arena = [];
    for (let r = 0; r < 5; r++) {
        arena[r] = [];
        for (let c = 0; c < COLS; c++) {
            arena[r][c] = COLORS[Math.floor(Math.random() * COLORS.length)];
        }
    }
    spawnPlayerBall();
}

function spawnPlayerBall() {
    playerBall = {
        x: canvas.width / 2,
        y: canvas.height - 40,
        color: COLORS[Math.floor(Math.random() * COLORS.length)],
        vx: 0,
        vy: 0,
        active: false
    };
}

function draw() {
    ctx.clearRect(0, 0, canvas.width, canvas.height);

    // 1. 가이드 점선 그리기 (대포 대신)
    if (!playerBall.active) {
        ctx.beginPath();
        ctx.setLineDash([5, 10]);
        ctx.moveTo(playerBall.x, playerBall.y);
        ctx.lineTo(mousePos.x, mousePos.y);
        ctx.strokeStyle = 'rgba(255, 255, 255, 0.2)';
        ctx.stroke();
        ctx.setLineDash([]);
    }

    // 2. 아레나 버블 그리기
    for (let r = 0; r < arena.length; r++) {
        for (let c = 0; c < COLS; c++) {
            if (arena[r][c]) {
                drawCircle(c * RADIUS * 2 + RADIUS + (r % 2 * RADIUS), r * RADIUS * 1.8 + RADIUS, RADIUS, arena[r][c]);
            }
        }
    }

    // 3. 발사할 공 그리기
    drawCircle(playerBall.x, playerBall.y, RADIUS, playerBall.color);
}

function drawCircle(x, y, r, color) {
    ctx.beginPath();
    ctx.arc(x, y, r - 2, 0, Math.PI * 2);
    ctx.fillStyle = color;
    ctx.fill();
    // 입체감 효과
    const grad = ctx.createRadialGradient(x - r/3, y - r/3, 1, x, y, r);
    grad.addColorStop(0, 'rgba(255,255,255,0.4)');
    grad.addColorStop(1, 'rgba(0,0,0,0.2)');
    ctx.fillStyle = grad;
    ctx.fill();
    ctx.closePath();
}

function update() {
    if (playerBall.active) {
        playerBall.x += playerBall.vx;
        playerBall.y += playerBall.vy;

        // 벽 반사
        if (playerBall.x < RADIUS || playerBall.x > canvas.width - RADIUS) playerBall.vx *= -1;
        
        // 천장 도달 혹은 충돌 체크 (단순화된 로직)
        if (playerBall.y < RADIUS || checkCollision()) {
            snapBall();
            spawnPlayerBall();
        }
    }
    draw();
    requestAnimationFrame(update);
}

function checkCollision() {
    for (let r = 0; r < arena.length; r++) {
        for (let c = 0; c < COLS; c++) {
            if (arena[r] && arena[r][c]) {
                const bx = c * RADIUS * 2 + RADIUS + (r % 2 * RADIUS);
                const by = r * RADIUS * 1.8 + RADIUS;
                const dist = Math.hypot(playerBall.x - bx, playerBall.y - by);
                if (dist < RADIUS * 1.8) return true;
            }
        }
    }
    return false;
}

function snapBall() {
    const r = Math.max(0, Math.round((playerBall.y - RADIUS) / (RADIUS * 1.8)));
    const c = Math.max(0, Math.min(COLS - 1, Math.round((playerBall.x - RADIUS - (r % 2 * RADIUS)) / (RADIUS * 2))));
    
    if (!arena[r]) arena[r] = [];
    arena[r][c] = playerBall.color;
    
    // 같은 색 터뜨리기 로직은 생략 가능하나 필요시 추가
    score += 10;
    scoreDelta.innerText = `SCORE: ${score}`;
}

// 이벤트 리스너
canvas.addEventListener('mousemove', (e) => {
    const rect = canvas.getBoundingClientRect();
    mousePos.x = e.clientX - rect.left;
    mousePos.y = e.clientY - rect.top;
});

canvas.addEventListener('click', () => {
    if (playerBall.active) return;
    const angle = Math.atan2(mousePos.y - playerBall.y, mousePos.x - playerBall.x);
    playerBall.vx = Math.cos(angle) * 8;
    playerBall.vy = Math.sin(angle) * 8;
    playerBall.active = true;
});

init();
update();
</script>
</body>
</html>
